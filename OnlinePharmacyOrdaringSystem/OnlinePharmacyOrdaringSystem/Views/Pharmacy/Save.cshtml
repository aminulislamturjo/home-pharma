@*@model OnlinePharmacyOrdaringSystem.Models.Pharmacy
@{
    ViewBag.Title = "Save";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Pharmacy</h2>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    

    <div class="form-horizontal">
        <h4>Register idUserUser</h4>
        <hr/>

        @ViewBag.Message

        @Html.ValidationSummary(true)

        <div class="form-group">
            @Html.LabelFor(model => model.PharmacyName, new {@class = "control-label col-md-2"})
            <div class="col-md-10">
                @Html.EditorFor(model => model.PharmacyName)
                @Html.ValidationMessageFor(model => model.PharmacyName)
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.Owner, new {@class = "control-label col-md-2"})
            <div class="col-md-10">
                @Html.EditorFor(model => model.Owner)
                @Html.ValidationMessageFor(model => model.Owner)
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.Address, new {@class = "control-label col-md-2"})
            <div class="col-md-10">
                @Html.EditorFor(model => model.Address)
                @Html.ValidationMessageFor(model => model.Address)
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.Email, new {@class = "control-label col-md-2"})
            <div class="col-md-10">
                @Html.EditorFor(model => model.Email)
                @Html.ValidationMessageFor(model => model.Email)
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.ContactNo, new {@class = "control-label col-md-2"})
            <div class="col-md-10">
                @Html.EditorFor(model => model.ContactNo)
                @Html.ValidationMessageFor(model => model.ContactNo)
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.Latitude, new {@class = "control-label col-md-2"})
            <div class="col-md-10">
                @Html.EditorFor(model => model.Latitude)
                @Html.ValidationMessageFor(model => model.Latitude)
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.Longitude, new {@class = "control-label col-md-2"})
            <div class="col-md-10">
                @Html.EditorFor(model => model.Longitude)
                @Html.ValidationMessageFor(model => model.Longitude)
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(model => model.Description, new {@class = "control-label col-md-2"})
            <div class="col-md-10">
                @Html.EditorFor(model => model.Description)
                @Html.ValidationMessageFor(model => model.Description)
            </div>
        </div>

    <div class="form-group">
        @Html.LabelFor(model => model.Date, new {@class = "control-label col-md-2"})
        <div class="col-md-10">
            <select id="Select1">
                <option>@DateTime.Now</option>
            </select>
        </div>
    </div>

        <div class="form-group">
            @Html.LabelFor(model => model.PharmUserId, new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                <select id="Select2">
                    <option>@Session["PharmacyUserID"]</option>
                </select>
            </div>
        </div>

    <div class="form-group">
            @Html.LabelFor(model => model.FindLocation, new { @class = "control-label col-md-2" })


      


            <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
            <script type="text/javascript">
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function (p) {
                        var LatLng = new google.maps.LatLng(p.coords.latitude, p.coords.longitude);
                        var mapOptions = {
                            center: LatLng,
                            zoom: 13,
                            mapTypeId: google.maps.MapTypeId.ROADMAP,
                            
                        };
                        var map = new google.maps.Map(document.getElementById("dvMap"), mapOptions);
                        var marker = new google.maps.Marker({
                            position: LatLng,
                            draggable: true,
                            map: map,
                            title: "<div style = 'height:60px;width:200px'><b>Your location:</b><br />Latitude: " + p.coords.latitude + "<br />Longitude: " + p.coords.longitude
                        });
                        google.maps.event.addListener(marker, "click", function (e) {
                            var infoWindow = new google.maps.InfoWindow();
                            infoWindow.setContent(marker.title);
                            infoWindow.open(map, marker);
                        });
                    });
                } else {
                    alert('Geo Location feature is not supported in this browser.');
                }
            </script>
            <div id="dvMap" style="width: 500px; height: 500px">
            </div>


        </div>

        
        

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Register" class="btn btn-default"/>
            </div>
        </div>
    </div>
    
}



<div>
    @Html.ActionLink("Add new idUserUser", "Save")
</div>

@section scripts
{
    @Scripts.Render("~/bundles/jqueryval")
}*@


@*New*@


@using OnlinePharmacyOrdaringSystem.Models


@{
    ViewBag.Title = "Save";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


@*Google Map*@
<!DOCTYPE html>
<html>
<head>
    
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Google Maps JavaScript API v3 Example: Geocoding Simple</title>
    <link href="http://code.google.com/apis/maps/documentation/javascript/examples/default.css" rel="stylesheet" type="text/css"/>
    <script src="http://maps.google.com/maps/api/js?v=3.5&amp;sensor=false"></script>
    <script type="text/javascript">
        var geocoder = new google.maps.Geocoder();


        function geocodePosition(pos) {
            geocoder.geocode({
                latLng: pos
            }, function(responses) {
                if (responses && responses.length > 0) {
                    updateMarkerAddress(responses[0].formatted_address);
                } else {
                    updateMarkerAddress('Cannot determine address at this location.');
                }
            });
        }

        function updateMarkerStatus(str) {
            document.getElementById('markerStatus').innerHTML = str;
        }

        function updateMarkerPosition(latLng) {
            document.getElementById('info').innerHTML = [
                latLng.lat(),
                latLng.lng()
            ].join(', ');
        }

        function updateMarkerAddress(str) {
            document.getElementById('address').innerHTML = str;
        }

        function initialize(navigator) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(p) {
                    //console.log(p.coords.latitude);
                    //console.log("hello");
                    var latLng = new google.maps.LatLng(p.coords.latitude, p.coords.longitude);
                    //var latLng = new google.maps.LatLng(-34.397, 150.644);
                    var map = new google.maps.Map(document.getElementById('mapCanvas'), {
                        zoom: 8,
                        center: latLng,
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                    });
                    var marker = new google.maps.Marker({
                        position: latLng,
                        title: 'Point A',
                        map: map,
                        draggable: true
                    });

                    // Update current position info.
                    updateMarkerPosition(latLng);
                    geocodePosition(latLng);

                    // Add dragging event listeners.
                    google.maps.event.addListener(marker, 'dragstart', function() {
                        updateMarkerAddress('Dragging...');
                    });

                    google.maps.event.addListener(marker, 'drag', function() {
                        updateMarkerStatus('Dragging...');
                        updateMarkerPosition(marker.getPosition());
                    });

                    google.maps.event.addListener(marker, 'dragend', function() {
                        updateMarkerStatus('Drag ended');
                        geocodePosition(marker.getPosition());
                    });
                });
            } else {
                var latLng = new google.maps.LatLng(-34.397, 150.644);
                var map = new google.maps.Map(document.getElementById('mapCanvas'), {
                    zoom: 8,
                    center: latLng,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                });
                var marker = new google.maps.Marker({
                    position: latLng,
                    title: 'Point A',
                    map: map,
                    draggable: true
                });

                // Update current position info.
                updateMarkerPosition(latLng);
                geocodePosition(latLng);

                // Add dragging event listeners.
                google.maps.event.addListener(marker, 'dragstart', function() {
                    updateMarkerAddress('Dragging...');
                });

                google.maps.event.addListener(marker, 'drag', function() {
                    updateMarkerStatus('Dragging...');
                    updateMarkerPosition(marker.getPosition());
                });

                google.maps.event.addListener(marker, 'dragend', function() {
                    updateMarkerStatus('Drag ended');
                    geocodePosition(marker.getPosition());
                });
            }

        }

        // Onload handler to fire off the app.
        google.maps.event.addDomListener(window, 'load', function() {
            initialize(navigator);
        });
    </script>
</head>
<body>
    <style>
        #mapCanvas {
            width: 500px;
            height: 400px;
            float: left;
        }

        #infoPanel {
            float: left;
            margin-left: 10px;
        }

            #infoPanel div {
                margin-bottom: 5px;
            }
    </style>

    <div id="mapCanvas"></div>
    <div id="infoPanel">
        <b>Marker status:</b>
        <div id="markerStatus">
            <i>Click and drag the marker.</i>
        </div>
        <b>Current position:</b>
        <div id="info"></div>
        <b>Closest matching address:</b>
        <div id="address"></div>
    </div>
</body>
</html>





@*Save pharmacy*@
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script src="~/Scripts/bootstrap.min.js"></script>
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />

<div align="center" style="font-size: 40px">Save Pharmacy</div>

<div class="container" style="margin-top:3%">
    <div class="row">
        @*<div class="col-md-6 col-md-offset-2 alert alert-info">
            
        </div>*@
        <div class="col-md-6 col-md-offset-7 alert alert-info">
            <div>
                <form id="Registration">

                    <div class="form-group">
                        <label for="pharmUserId">Owner Name</label>
                        <input class="form-control" type="hidden" name="pharmUserId" id="pharmUserId" value="@Session["PharmacyUserID"]" readonly="readonly"/>
                        <input class="form-control" type="text" name="Owner" id="Owner" value="@Session["PharmacyUsername"]" readonly="readonly" />

                    </div>

                

                    <div class="form-group">
                        <div class="input-group">
                            @*<span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>*@
                            <input class="form-control" type="text" name="PharmacyName" id="PharmacyName" placeholder="Pharmacy Name"/>
                        </div>
                    </div>

                    


                    <div class="form-group">
                        <div class="input-group">
                            @*<span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>*@
                            <input class="form-control" type="text" name="Address" id="Address" placeholder="Address"/>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-group">
                            @*<span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>*@
                            <input class="form-control" type="text" name="email" id="email" placeholder="Email"/>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-group">
                            @*<span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>*@
                            <input class="form-control" type="text" name="ContactNo" id="ContactNo" placeholder="Contact No."/>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-group">
                            @*<span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>*@
                            <input class="form-control" type="text" name="Longitude" id="Longitude" placeholder="Longitude"/>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-group">
                            @*<span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>*@
                            <input class="form-control" type="text" name="Latitude" id="Latitude" placeholder="Latitude"/>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-group">
                            @*<span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>*@
                            <input class="form-control" type="text" name="Description" id="Description" placeholder="Description"/>
                        </div>
                    </div>



                    <div class="form-group">
                        <div class="input-group">
                            @*<span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>*@
                            <input class="form-control" type="date" name="date" id="date"/>
                        </div>
                    </div>

                    @*<div class="form-group">
                    <label for="pharmUserId">User ID</label>
                    <select id="pharmUserId" name="pharmUserId" class="form-control">
                        <option value=""></option>

                        <option value="@Session["PharmacyUserID"]">@Session["Username"]</option>

                    </select>
                </div>*@
      



                </form>

                <div class="form-group">
                    <button class="btn btn-info form-control" type="submit" onclick="SaveForm()"><i class="glyphicon glyphicon-registration-mark"></i> Submit</button>
                </div>
            </div>
        </div>
    </div>
</div>







<script>

    function SaveForm() {
   


        var data = $("#Registration").serialize();
        $.ajax({
            type: "post",
            data: data,
            url: "/Pharmacy/Save",
            success: function (result) {

            
                $("#Registration")[0].reset();
                alert("Saved successfullyy");
            }
        });
    }


</script>